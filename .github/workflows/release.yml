# .github/workflows/release.yaml
name: Auto Release Notes

on:
  push:
    # Trigger when pushing a tag like v1.0.0
    tags:
      - 'v*.*.*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Get commits since last tag
        id: commits
        run: |
          # Get the previous tag
          PREV_TAG=$(git describe --tags --abbrev=0 ${GITHUB_REF}^)
          echo "Previous tag: $PREV_TAG"

          # List commits since previous tag
          COMMITS=$(git log $PREV_TAG..HEAD --pretty=format:"- %s")
          echo "commits<<EOF" >> $GITHUB_OUTPUT
          echo "$COMMITS" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Create GitHub Release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ github.ref_name }}
          release_name: ${{ github.ref_name }}
          body: |
            ## Changes

            ${{ steps.commits.outputs.commits }}
          draft: false
          prerelease: false
